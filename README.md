ä¼ä¸šå¾®ä¿¡github / gitlabæœºå™¨äºº

[![All Contributors](https://img.shields.io/badge/all_contributors-1-orange.svg?style=flat-square)](#contributors)
[![docker build](https://img.shields.io/docker/automated/leoeatle/wxwork-git-robot)](https://cloud.docker.com/repository/docker/leoeatle/wxwork-git-robot/builds)

# Changelog
2020-1
æ”¯æŒäº†è…¾è®¯äº‘äº‘å‡½æ•°çš„åˆ›å»º

ä½¿ç”¨æ–¹å¼ï¼š
åœ¨githubä¸­çš„`Webhook`é…ç½®
```
http://link.zhihu.com/?target=https%3A//service-5mv1fv1k-1251767583.gz.apigw.tencentcs.com/release/wechatwork_git_robot?id={robotid}
```
å…¶ä¸­robotidæ˜¯ä½ éœ€è¦æ¨é€çš„æœºå™¨äººid

`id`å‚æ•°ä»£è¡¨è‡ªå®šä¹‰çš„æœºå™¨äººidï¼Œå¯ä»¥åœ¨ä¼ä¸šå¾®ä¿¡çš„æœºå™¨äººåˆ—è¡¨ä¸­æŸ¥çœ‹ï¼Œè§å›¾ï¼š

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/wework-demo.jpg)

è‡ªå»ºäº‘å‡½æ•°æ–¹å¼ï¼š
1. `git clone https://github.com/LeoEatle/git-webhook-wework-robot.git`
2. æ³¨å†Œå¹¶ç™»é™†è…¾è®¯äº‘ç®¡ç†åå°ï¼Œæ–°å»ºä¸€ä¸ªäº‘å‡½æ•°ï¼Œå¯ä»¥å…ˆé€‰ä¸ªNodeçš„Helloworldæ¨¡æ¿
3. å°†ä»£ç ä¸­çš„`cloud`ç›®å½•ä¸Šä¼ ï¼Œè§å›¾
![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-01-16%20%E4%B8%8A%E5%8D%8811.03.40.png)

4. ç‚¹å‡»ä¿å­˜ï¼ˆä¿å­˜åğŸ‰‘ï¸æµ‹è¯•è¯•è¯•ï¼‰
![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_0dc98a64-9a31-4bcb-bf67-dbba9ed2327f.png)

5. é€‰æ‹©è§¦å‘æ–¹å¼ï¼Œæ·»åŠ æ–°çš„è§¦å‘æ–¹å¼ï¼Œç±»å‹é€‰æ‹©APIç½‘å…³ï¼Œä¿å­˜åå¾—åˆ°url
![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/add_new.png)

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/save_new.png)

6. ok!å¯ä»¥å¡«åˆ°Githubçš„webhooké‡Œäº†ï¼Œç±»å‹é€‰æ‹©`Send me everything`ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œurlå¡«ä¸Šä¸Šé¢çš„urlï¼Œ**åˆ«å¿˜äº†è¦åœ¨åé¢åŠ ä¸Š`?id={ä½ çš„æœºå™¨äººid}`ä½œä¸ºå‚æ•°**ã€‚

å¯è§ä¸‹é¢[å¦‚ä½•ä½¿ç”¨](https://github.com/LeoEatle/git-webhook-wework-robot#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8)ã€‚

2019-8
1. dockeré•œåƒä¸Šä¼ åˆ°æ–°åœ°å€ï¼šhttps://cloud.docker.com/repository/docker/leoeatle/wxwork-git-robot

2019-7
1. ç”±äºä¸€ç›´åœ¨ç»´æŠ¤å…¬å¸å†…çš„æœºå™¨äººï¼Œæœ‰äº›æ”¹åŠ¨ä¸é€‚ç”¨äºå¤–éƒ¨ä½¿ç”¨ã€‚å•ç‹¬åˆ†å¼€ä¸¤ä¸ªé¡¹ç›®ï¼Œä¸å†ä½œä¸ºä¸¤ä¸ªåˆ†æ”¯ç®¡ç†ã€‚

2019-6
1. é‡æ–°å®¡è§†ä¹‹å‰çš„`dockerfile`æ„Ÿè§‰è¿‡äºè‡ƒè‚¿ï¼Œä¸å¦‚ç›´æ¥æŠŠdistæ‰“åŒ…è¿›dockerï¼Œæ‰€ä»¥è¿›è¡Œäº†ä¿®æ”¹
2. ä¹‹å‰çš„è…¾è®¯äº‘æœåŠ¡å™¨æ²¡é’±äº†ï¼Œwework-robot.xyz å®£å‘Šåœæ­¢æœåŠ¡ï¼Œå¦‚æœ‰éœ€è¦è¯·è‡ªè¡Œæ­å»º

# ç›®å‰æ”¯æŒçš„äº‹ä»¶
## Push event ç¤ºä¾‹

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/WeWork%20Helper20190823102904.png)

## Issue event ç¤ºä¾‹

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/issue2.png)

## Merge Request ç¤ºä¾‹

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/git-robot/mr2.png)

Merge Request ä¼šæœ‰å‘èµ·ã€åˆå¹¶ã€å…³é—­ã€é‡æ–°å‘èµ·ç­‰å‡ ç§æƒ…å†µï¼Œæ–‡æ¡ˆä¼šæœ‰æ‰€ä¸åŒã€‚

# å¦‚ä½•ä½¿ç”¨

## Github

å¦‚æœæ˜¯ä½¿ç”¨githubï¼Œåœ¨githubé¡¹ç›®ä¸­çš„`Setting`ä¸­é€‰æ‹©`Webhooks`ï¼Œé€‰æ‹©`Add Webhooks`ï¼Œå¡«å†™urlï¼Œå¦‚`http://{{ä½ çš„åŸŸåæˆ–è€…IP}}/github?id=7048958e-8b4b-4381-9758-af84347c240c`ã€‚

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/github-demo.png)

`/github`ç”¨æ¥åŒºåˆ†githubå’Œgitlabï¼Œè¿™ä¸¤è€…çš„å¤„ç†æ–¹å¼ä¸åŒã€‚

`id`å‚æ•°ä»£è¡¨è‡ªå®šä¹‰çš„æœºå™¨äººidï¼Œå¯ä»¥åœ¨ä¼ä¸šå¾®ä¿¡çš„æœºå™¨äººåˆ—è¡¨ä¸­æŸ¥çœ‹ï¼Œè§å›¾ï¼š

![](https://tuchuang-1251767583.cos.ap-guangzhou.myqcloud.com/wework-demo.jpg)

## Gitlab

å¦‚æœæ˜¯gitlabï¼Œå°†webhookåœ°å€æ”¹ä¸º`http://{{ä½ çš„åŸŸåæˆ–è€…IP}}/git?id={{æœºå™¨äººid}}`

æ³¨æ„è¿™é‡Œçš„è·¯ç”±æ˜¯**git**

2019-10-17 æ›´æ–°
ç°åœ¨**gitlab**è·¯ç”±ä¹Ÿä¼šæŒ‡å‘åŒæ ·çš„åŠŸèƒ½äº†ï¼Œæ‰€ä»¥ä¸¤ç§è·¯ç”±éƒ½å¯ä»¥


# å¦‚ä½•éƒ¨ç½²

**å»ºè®®å°†æ­¤æœåŠ¡éƒ¨ç½²åœ¨è‡ªå·±çš„æœºå™¨ä¸Š**

## æœ€ç®€å•çš„æ–¹å¼

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
git pull https://github.com/LeoEatle/git-webhook-wework-robot.git
npm install
npm run build
pm2 start ./dist/server.js
```

## ä½¿ç”¨docker

ç›®å‰å·²ç»ç¼–è¯‘å‡ºäº†ä¸€ä»½é•œåƒæ–‡ä»¶ï¼Œåœ°å€ï¼šhttps://cloud.docker.com/repository/docker/leoeatle/wxwork-git-robot
```shell
// å…ˆç™»å½•
sudo docker pull https://cloud.docker.com/repository/docker/leoeatle/wxwork-git-robot:latest
docker run -d leoeatle/wxwork-git-robot
```
å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨pm2-dockeræ¥åŒæ—¶åˆ©ç”¨åˆ°pm2å’Œdockerã€‚

## æœºå™¨äººidé…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹æœåŠ¡å™¨ç«¯çš„é»˜è®¤æœºå™¨äººidè®¾ç½®ï¼Œè¯·ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`.env`

```conf
PORT=8080
NODE_ENV=development
JWT_SECRET=your-secret-whatever
DATABASE_URL=postgres://user:pass@localhost:5432/apidb
CHAT_ID=82c08203-82a6-4824-8319-04a361bc0b2a # æ”¹è¿™é‡Œï¼
```
# é¡¹ç›®ä»‹ç» && å¼€å‘ï¼ˆçƒ­çƒˆæ¬¢è¿æPRï¼‰

æ­¤é¡¹ç›®ç”¨äºè¿æ¥git webhookå’Œä¼ä¸šå¾®ä¿¡æœºå™¨äººwebhookï¼Œé‡‡ç”¨koa2 + typescriptå¼€å‘ï¼Œå¤§éƒ¨åˆ†git webhook å’Œ ä¼ä¸šå¾®ä¿¡æœºå™¨äººçš„æ•°æ®ç»“æ„å·²ç»å®šä¹‰å¥½typingï¼Œå¦‚ï¼š

```typescript
interface Repository {
    name: string;
    description: string;
    homepage: string;
    git_http_url: string;
    git_ssh_url: string;
    url: string;
    visibility_level: number;
}
```

å¹¶ä¸”é¡¹ç›®æœ‰é…ç½®ä¸¥æ ¼çš„tslintå’Œlint-stagedç­‰æ£€æŸ¥ã€‚

å¼‚æ­¥è§£å†³æ–¹æ¡ˆä¸º`async/await`

githubäº‹ä»¶handler: `github.ts`
gitlabäº‹ä»¶handler: `gilab.ts`

chatRobotæ¨é€ä¿¡æ¯ç›¸å…³: `chat.ts`

## æäº¤

```bash
git add .
npm run commit # è®©commitlintè‡ªåŠ¨ç”Ÿæˆcommitä¿¡æ¯
```

# TODO

* ç›®å‰gitlabåªåšäº†`push`å’Œ`merge request`äº‹ä»¶çš„handlerï¼Œä»¥åŠåªåšäº†æ–‡å­—å’Œmardownä¿¡æ¯çš„æ¨é€ï¼Œå…¶ä½™äº‹ä»¶å’Œå…¶ä»–ç±»å‹çš„æ¨é€è¿˜éœ€å¼€å‘ã€‚

* githubæ¨é€ç›®å‰åªè€ƒè™‘`push` `pr` `issue`ï¼Œå…¶ä»–æœ‰å¾…æ·»åŠ 

* ~~ä¸ºäº†æ–¹ä¾¿å…¶ä»–å›¢é˜Ÿç”šè‡³å¤–é¢å¼€æºçš„ä½¿ç”¨ï¼Œè€ƒè™‘ä½¿ç”¨dockeræ–¹ä¾¿è‡ªå·±éƒ¨ç½²ã€‚~~

* ~~è€ƒè™‘æ˜¯ä¸æ˜¯å¯ä»¥åœ¨é…ç½®webhookçš„åœ°æ–¹ç›´æ¥é…ç½®æœºå™¨äººidï¼Œåˆ†åˆ«æ¨é€~~

* ~~è¿›ä¸€æ­¥è€ƒè™‘æ˜¯ä¸æ˜¯å¯ä»¥ç”¨GUIç»Ÿä¸€ç®¡ç†é¡¹ç›®å’Œæœºå™¨äººidçš„å…³ç³»~~

* è€ƒè™‘å¯ä»¥è¡¥å…¨gitlabçš„typingï¼Œå®åœ¨å¤ªå¤šäº†ï¼Œæœ‰äººå¸®å¿™å°±å¥½äº†ï¼Œgithubå·²ç»ä½¿ç”¨äº†æœ‰äººå¼€æºæ•´ç†çš„typingä¾èµ–åº“

## Contributors âœ¨

Thanks goes to these wonderful people ([emoji key](https://allcontributors.org/docs/en/emoji-key)):

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore -->
<table>
  <tr>
    <td align="center"><a href="http://blog.soul11201.com"><img src="https://avatars1.githubusercontent.com/u/8514816?v=4" width="100px;" alt="soul11201"/><br /><sub><b>soul11201</b></sub></a><br /><a href="https://github.com/LeoEatle/git-webhook-wework-robot/issues?q=author%3Anoname007" title="Bug reports">ğŸ›</a> <a href="https://github.com/LeoEatle/git-webhook-wework-robot/commits?author=noname007" title="Code">ğŸ’»</a></td>
    <td align="center"><a href="https://liubiantao.github.io"><img src="https://avatars1.githubusercontent.com/u/3268218?v=4" width="100px;" alt="Haitao"/><br /><sub><b>Haitao</b></sub></a><br /><a href="https://github.com/LeoEatle/git-webhook-wework-robot/issues?q=author%3Aliubiantao" title="Bug reports">ğŸ›</a> <a href="https://github.com/LeoEatle/git-webhook-wework-robot/commits?author=liubiantao" title="Code">ğŸ’»</a></td>
  </tr>
</table>

<!-- ALL-CONTRIBUTORS-LIST:END -->

This project follows the [all-contributors](https://github.com/all-contributors/all-contributors) specification. Contributions of any kind welcome!
